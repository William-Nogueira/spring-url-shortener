<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShortLink - Professional URL Shortener</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans min-h-screen flex flex-col items-center justify-center p-4">

<div class="w-full max-w-lg bg-gray-800 p-8 rounded-2xl shadow-2xl border border-gray-700">

    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">
            ShortLink
        </h1>
        <p class="text-gray-400 mt-2">Simplify your links, track your reach.</p>
    </div>

    <form id="shortenForm" class="space-y-4">
        <div>
            <label for="urlInput" class="block text-sm font-medium text-gray-400 mb-1">Enter long URL</label>
            <input type="text" id="urlInput" placeholder="e.g. www.google.com" required
                   class="w-full px-4 py-3 bg-gray-900 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-white placeholder-gray-600">

            <div id="errorContainer" class="hidden mt-3 p-3 bg-red-900/30 border border-red-800 rounded-lg flex items-start space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-400 flex-shrink-0 mt-0.5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
                <p id="errorMsg" class="text-sm text-red-300"></p>
            </div>
        </div>

        <button type="submit" id="submitBtn"
                class="w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white font-bold rounded-lg shadow-lg transform transition hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed">
            Shorten URL
        </button>
    </form>

    <div id="resultCard" class="hidden mt-8 pt-6 border-t border-gray-700 animate-fade-in">
        <div class="flex items-center justify-between bg-gray-900 p-4 rounded-lg border border-gray-700 relative">
            <a id="shortLink" href="#" target="_blank" class="text-emerald-400 hover:underline truncate mr-4 font-mono text-lg"></a>

            <div class="flex items-center">
                <span id="copyFeedback" class="hidden text-xs text-emerald-400 font-bold mr-2 animate-bounce">Copied!</span>

                <button onclick="copyToClipboard()" class="text-gray-400 hover:text-white transition p-2 rounded-md hover:bg-gray-800" title="Copy to clipboard">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                    </svg>
                </button>
            </div>
        </div>
        <div class="mt-4 text-center">
            <a id="statsLink" href="#" class="text-xs hover:text-blue-400 transition">View Stats</a>
        </div>
    </div>
</div>

<div class="mt-12 text-gray-500 text-sm">
    <a href="/swagger-ui/index.html" class="hover:text-blue-400 transition underline">Developer API</a>
</div>

<script>
    const form = document.getElementById('shortenForm');
    const urlInput = document.getElementById('urlInput');
    const submitBtn = document.getElementById('submitBtn');
    const resultCard = document.getElementById('resultCard');
    const shortLink = document.getElementById('shortLink');
    const errorContainer = document.getElementById('errorContainer');
    const errorMsg = document.getElementById('errorMsg');
    const statsLink = document.getElementById('statsLink');
    const copyFeedback = document.getElementById('copyFeedback');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        errorContainer.classList.add('hidden');
        resultCard.classList.add('hidden');
        copyFeedback.classList.add('hidden');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Shortening...';

        const originalUrl = urlInput.value;

        try {
            const response = await fetch(`/api/shorten?url=${encodeURIComponent(originalUrl)}`, { method: 'POST' });

            if (!response.ok) {
                const contentType = response.headers.get("content-type");
                if (contentType && contentType.includes("application/json")) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || errorData.error || 'Failed to shorten URL');
                } else {
                    const text = await response.text();
                    throw new Error(text || `Error ${response.status}`);
                }
            }

            const data = await response.json();

            shortLink.href = data.shortUrl;
            shortLink.textContent = data.shortUrl;

            const urlObj = new URL(data.shortUrl);
            const pathSegments = urlObj.pathname.split('/');
            const code = pathSegments.findLast(segment => segment.length > 0);

            statsLink.href = `/stats/${code}`;

            resultCard.classList.remove('hidden');
        } catch (err) {
            errorMsg.textContent = err.message;
            errorContainer.classList.remove('hidden');
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Shorten URL';
        }
    });

    function copyToClipboard() {
        const textToCopy = shortLink.textContent;
        navigator.clipboard.writeText(textToCopy).then(() => {
            copyFeedback.classList.remove('hidden');
            setTimeout(() => {
                copyFeedback.classList.add('hidden');
            }, 2000);
        }).catch(err => {
            console.error('Failed to copy:', err);
        });
    }
</script>
</body>
</html>